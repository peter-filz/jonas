# JONAS - Just Operate Nicely And Securely

[![License: GPL v3](https://img.shields.io/badge/License-GPLv3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0)

Ein intelligenter Shell-Assistent, der die OpenAI Responses API nutzt, um Shell-Befehle sicher auszuf√ºhren und nat√ºrliche Gespr√§che zu f√ºhren.

## Features

- ü§ñ **Intelligenter Chat**: Nat√ºrliche Gespr√§che mit automatischer Kontext-Verwaltung
- üîß **Tool-Calling**: Sichere Ausf√ºhrung von Shell-Befehlen mit Best√§tigung
- üìù **Markdown-Rendering**: Sch√∂ne Formatierung von Antworten
- üîÑ **Mehrere Tool-Calls**: Parallele Ausf√ºhrung mehrerer Befehle
- ‚ö° **Thinking-Anzeige**: Visuelles Feedback w√§hrend API-Aufrufen
- üîí **Sicherheitsabfragen**: Farbcodierte Best√§tigung (Rot=schreibend, Magenta=lesend)
- üé® **Rich Terminal UI**: Farbige, formatierte Ausgaben mit Box-Design
- üìä **Output-Management**: Gro√üe Outputs werden gespeichert und k√∂nnen durchsucht werden
- üîç **Output-Tools**: `get_output_head()`, `get_output_tail()`, `search_output()`, `display_output()`
- üìú **Session-Historie**: Automatische Speicherung der letzten 15 Turns
- üåê **Web-Search**: Integrierte Web-Suche f√ºr aktuelle Informationen
- üéØ **Auto-Korrektur**: Erkennt und korrigiert fehlende Tool-Calls

## Installation

### Via pip (empfohlen)

```bash
pip install jonas
```

Nach der Installation ist der Befehl `jonas` systemweit verf√ºgbar.

### Aus dem Quellcode

1. **Repository klonen:**
   ```bash
   git clone https://github.com/peterfilz/jonas.git
   cd jonas
   ```

2. **Installieren:**
   ```bash
   pip install -e .
   ```

## Konfiguration

Beim ersten Start von JONAS wirst du interaktiv nach folgenden Werten gefragt:

- **OPENAI_API_KEY**: Dein OpenAI API-Schl√ºssel
- **OPENAI_MODEL**: Das zu verwendende Modell (z.B. `gpt-4o`, `gpt-4.1`)
- **TOKENLIMIT**: Token-Schwellenwert f√ºr Output-Speicherung (Standard: 300)

Die Konfiguration wird in `jonas.cfg` gespeichert.

Zum √Ñndern der Konfiguration verwende im Chat:
```
config
```

## Verwendung

Starte JONAS einfach mit:
```bash
jonas
```

### Verf√ºgbare Befehle:
- `exit`, `quit`, `bye` - Chat beenden
- `config` (oder `configure`) - Konfiguration √§ndern (API-Key, Model, TokenLimit)
- `delconfig` - Konfiguration l√∂schen und beenden
- `history` - Gespeicherte Session-Historie anzeigen

- Oder gebe Anweisungen in nat√ºrlicher Sprache ein

### Beispiel-Interaktion:

```
Du: Zeige mir den Inhalt von /Users
Intention: Verzeichnisinhalt anzeigen
Befehl:    ls /Users
Ausf√ºhren? [j/N] j

Jonas: Das Verzeichnis /Users enth√§lt: Applications, Library, Users, ...

Du: Welche Python-Version verwendest du?
Intention: Python-Version pr√ºfen
Befehl:    python3 --version
Ausf√ºhren? [j/N] j

Jonas: Ich verwende Python 3.12.0

Du: history
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Session-Historie:
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

Du: Zeige mir den Inhalt von /Users
Jonas: Das Verzeichnis /Users enth√§lt...
Ausgef√ºhrte Befehle:
  ‚Ä¢ ls /Users ‚Üí out1

Du: exit
Auf Wiedersehen!
```

## Features im Detail

### Tool-Calling mit Sicherheit
- **Readonly-Flag**: Befehle werden als lesend (Magenta) oder schreibend (Rot) markiert
- **Intention-Anzeige**: Zeigt, was der Befehl tun soll
- **Best√§tigungs-Prompts**: Jeder Befehl erfordert explizite Best√§tigung
- **Auto-Korrektur**: Erkennt, wenn das Modell Aktionen behauptet ohne Tool-Call
- **Timeout**: 5 Minuten f√ºr l√§ngere Befehle (apt-get upgrade, docker build, etc.)

### Output-Management
- **Automatische Speicherung**: Outputs >300 Tokens werden als `out1`, `out2`, etc. gespeichert
- **get_output_head(output_id, num_lines)**: Zeigt die ersten N Zeilen
- **get_output_tail(output_id, num_lines)**: Zeigt die letzten N Zeilen
- **search_output(output_id, pattern)**: Durchsucht Output mit Regex
- **display_output(output_id)**: Zeigt kompletten Output an
- **Automatische Bereinigung**: Alte Outputs werden beim History-Trimming gel√∂scht

### Session-Historie
- **Automatisches Trimming**: Maximal 15 User/Assistant-Paare werden gespeichert
- **Persistente Output-IDs**: Zugriff auf fr√ºhere Befehlsausgaben
- **JSON-Struktur**: `{"answer": "...", "executed_commands": [...]}`
- **History-Befehl**: Zeigt alle gespeicherten Turns mit ausgef√ºhrten Befehlen

### Markdown-Rendering
- Tabellen werden korrekt formatiert
- Code-Bl√∂cke mit Syntax-Highlighting
- Listen, Links und andere Markdown-Elemente
- Rich Terminal-Ausgaben mit Farben


## Projekt-Struktur

```
jonas/
‚îú‚îÄ‚îÄ jonas.py             # Haupt-Chat-Anwendung mit Dialog-Logik
‚îú‚îÄ‚îÄ shell_tools.py       # Tool-Definitionen und Shell-Ausf√ºhrung
‚îú‚îÄ‚îÄ requirements.txt     # Python-Abh√§ngigkeiten
‚îú‚îÄ‚îÄ jonas.cfg           # Konfigurationsdatei (wird beim ersten Start erstellt)
‚îú‚îÄ‚îÄ venv/               # Virtuelle Umgebung
‚îî‚îÄ‚îÄ README.md          # Diese Datei
```

## Abh√§ngigkeiten

- `openai`: OpenAI API-Client (Responses API)
- `pydantic>=2.7.0`: Datenvalidierung
- `rich>=13.7.0`: Sch√∂ne Terminal-Ausgaben mit Markdown-Support
- `tiktoken>=0.5.0`: Token-Z√§hlung f√ºr Output-Management
- `typer[all]>=0.12`: CLI-Framework

## Sicherheitshinweise

- ‚ö†Ô∏è **API-Keys** niemals committen!
- ‚ö†Ô∏è **Jeder Shell-Befehl** erfordert explizite Best√§tigung
- ‚ö†Ô∏è **Timeout** (5 Minuten) verhindert h√§ngende Prozesse
- ‚ö†Ô∏è **Readonly-Flag** signalisiert Risiko (Rot vs. Magenta)
- ‚ö†Ô∏è **Auto-Korrektur** verhindert Halluzinationen von Befehlsausf√ºhrungen
- ‚ö†Ô∏è **Output-Bereinigung** beim History-Trimming

## Autor

**Peter Filz**  
üìß peter.filz@googlemail.com

## Lizenz

GNU General Public License v3.0 oder sp√§ter - siehe LICENSE-Datei f√ºr Details.

JONAS ist freie Software: Sie k√∂nnen sie unter den Bedingungen der GNU General Public License,
wie von der Free Software Foundation ver√∂ffentlicht, weitergeben und/oder modifizieren,
entweder gem√§√ü Version 3 der Lizenz oder (nach Ihrer Option) jeder sp√§teren Version.

Dieses Programm wird in der Hoffnung verteilt, dass es n√ºtzlich sein wird, aber
OHNE JEDE GEW√ÑHRLEISTUNG. Siehe die GNU General Public License f√ºr weitere Details.
